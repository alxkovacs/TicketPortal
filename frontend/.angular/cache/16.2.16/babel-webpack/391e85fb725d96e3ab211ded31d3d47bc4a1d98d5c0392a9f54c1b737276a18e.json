{"ast":null,"code":"import { environment } from '../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class EventService {\n  constructor(http) {\n    this.http = http;\n    this.apiUrl = `${environment.apiUrl}/events`;\n  }\n  getEvents() {\n    return this.http.get(this.apiUrl);\n  }\n  getEvent(id) {\n    return this.http.get(`${this.apiUrl}/${id}`);\n  }\n  /**\n   * Új esemény létrehozása\n   * @param eventData Az új esemény adatai\n   */\n  createEvent(eventData) {\n    // Biztositsuk, hogy van legalabb egy jegykategoria\n    let ticketCategories = eventData.ticketCategories || [];\n    if (!Array.isArray(ticketCategories) || ticketCategories.length === 0) {\n      ticketCategories = [{\n        name: 'Alap jegy',\n        price: 1000,\n        availableSeats: 100 // Backend API az \"availableSeats\" nevet várja, nem \"availableTickets\"-et\n      }];\n    }\n    // Átkonvertáljuk a meglévő jegykategoriákat a backend által várt médon\n    ticketCategories = ticketCategories.map(category => {\n      // Clone to avoid mutating the original\n      const convertedCategory = {\n        ...category\n      };\n      // Rename availableTickets to availableSeats if it exists\n      if ('availableTickets' in convertedCategory) {\n        convertedCategory.availableSeats = convertedCategory.availableTickets;\n        delete convertedCategory.availableTickets;\n      } else if (!('availableSeats' in convertedCategory)) {\n        // Ha egyiket sem találjuk, adjunk hozzá alapértelmezetten 100-at\n        convertedCategory.availableSeats = 100;\n      }\n      return convertedCategory;\n    });\n    // Számítsuk ki a teljes jegy mennyiséget\n    const totalTickets = ticketCategories.reduce((sum, category) => sum + (Number(category.availableSeats) || 0), 0);\n    // Készítsünk egy típushelyes új eseményt\n    const newEvent = {\n      title: eventData.title,\n      description: eventData.description,\n      date: new Date(eventData.date).toISOString(),\n      location: eventData.location,\n      imageUrl: eventData.imageUrl || '',\n      ticketCategories: ticketCategories,\n      availableTickets: totalTickets\n    };\n    // Szerző hozzáadása, ha megtalálható\n    try {\n      // Először próbáljuk a user kulcsot\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        const userData = JSON.parse(userStr);\n        if (userData && userData.user && userData.user._id) {\n          newEvent.organizer = userData.user._id;\n        } else if (userData && userData._id) {\n          newEvent.organizer = userData._id;\n        }\n      }\n      // Ha nincs, próbáljuk a currentUser kulcsot\n      if (!newEvent.organizer) {\n        const currentUserStr = localStorage.getItem('currentUser');\n        if (currentUserStr) {\n          const currentUserData = JSON.parse(currentUserStr);\n          if (currentUserData && currentUserData._id) {\n            newEvent.organizer = currentUserData._id;\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Hiba a felhasználó ID kiolvasása közben:', e);\n    }\n    console.log('Küldés a szervernek:', newEvent);\n    return this.http.post(this.apiUrl, newEvent);\n  }\n  updateEvent(id, event) {\n    return this.http.put(`${this.apiUrl}/${id}`, event);\n  }\n  deleteEvent(id) {\n    return this.http.delete(`${this.apiUrl}/${id}`);\n  }\n  getOrganizerEvents() {\n    return this.http.get(`${environment.apiUrl}/api/users/my-events`);\n  }\n  /**\n   * Jegyvásárlás metódus\n   * @param eventId Az esemény azonosítója\n   * @param categoryId A jegy kategória azonosítója\n   * @param quantity A megvásárolni kívánt jegyek száma\n   * @returns A vásárlást visszaigazoló adatok\n   */\n  purchaseTicket(eventId, categoryId, quantity) {\n    const purchaseData = {\n      eventId,\n      categoryId,\n      quantity\n    };\n    // Az apiUrl alapból már tartalmazza a /api előtagot\n    return this.http.post(`${environment.apiUrl}/tickets`, purchaseData);\n  }\n  static {\n    this.ɵfac = function EventService_Factory(t) {\n      return new (t || EventService)(i0.ɵɵinject(i1.HttpClient));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: EventService,\n      factory: EventService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["environment","EventService","constructor","http","apiUrl","getEvents","get","getEvent","id","createEvent","eventData","ticketCategories","Array","isArray","length","name","price","availableSeats","map","category","convertedCategory","availableTickets","totalTickets","reduce","sum","Number","newEvent","title","description","date","Date","toISOString","location","imageUrl","userStr","localStorage","getItem","userData","JSON","parse","user","_id","organizer","currentUserStr","currentUserData","e","console","error","log","post","updateEvent","event","put","deleteEvent","delete","getOrganizerEvents","purchaseTicket","eventId","categoryId","quantity","purchaseData","i0","ɵɵinject","i1","HttpClient","factory","ɵfac","providedIn"],"sources":["D:\\SZTE_PROGINFO\\programrendszerek_fejlesztese\\TicketPortal\\frontend\\src\\app\\services\\event.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient, HttpParams } from '@angular/common/http';\nimport { Observable, catchError, throwError } from 'rxjs';\nimport { environment } from '../../environments/environment';\nimport { Event, NewEvent, TicketCategory } from '../models/event.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class EventService {\n  private apiUrl = `${environment.apiUrl}/events`;\n\n  constructor(private http: HttpClient) {}\n\n  getEvents(): Observable<Event[]> {\n    return this.http.get<Event[]>(this.apiUrl);\n  }\n\n  getEvent(id: string): Observable<Event> {\n    return this.http.get<Event>(`${this.apiUrl}/${id}`);\n  }\n\n  /**\n   * Új esemény létrehozása\n   * @param eventData Az új esemény adatai\n   */\n  createEvent(eventData: any): Observable<Event> {\n    // Biztositsuk, hogy van legalabb egy jegykategoria\n    let ticketCategories = eventData.ticketCategories || [];\n    if (!Array.isArray(ticketCategories) || ticketCategories.length === 0) {\n      ticketCategories = [{\n        name: 'Alap jegy',\n        price: 1000,\n        availableSeats: 100  // Backend API az \"availableSeats\" nevet várja, nem \"availableTickets\"-et\n      }];\n    }\n    \n    // Átkonvertáljuk a meglévő jegykategoriákat a backend által várt médon\n    ticketCategories = ticketCategories.map((category: any) => {\n      // Clone to avoid mutating the original\n      const convertedCategory = {...category};\n      // Rename availableTickets to availableSeats if it exists\n      if ('availableTickets' in convertedCategory) {\n        convertedCategory.availableSeats = convertedCategory.availableTickets;\n        delete convertedCategory.availableTickets;\n      } else if (!('availableSeats' in convertedCategory)) {\n        // Ha egyiket sem találjuk, adjunk hozzá alapértelmezetten 100-at\n        convertedCategory.availableSeats = 100;\n      }\n      return convertedCategory;\n    });\n    \n    // Számítsuk ki a teljes jegy mennyiséget\n    const totalTickets = ticketCategories.reduce(\n      (sum: number, category: any) => sum + (Number(category.availableSeats) || 0), 0\n    );\n\n    // Készítsünk egy típushelyes új eseményt\n    const newEvent: NewEvent = {\n      title: eventData.title,\n      description: eventData.description,\n      date: new Date(eventData.date).toISOString(),\n      location: eventData.location,\n      imageUrl: eventData.imageUrl || '',\n      ticketCategories: ticketCategories,\n      availableTickets: totalTickets\n    };\n    \n    // Szerző hozzáadása, ha megtalálható\n    try {\n      // Először próbáljuk a user kulcsot\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        const userData = JSON.parse(userStr);\n        if (userData && userData.user && userData.user._id) {\n          newEvent.organizer = userData.user._id;\n        } else if (userData && userData._id) {\n          newEvent.organizer = userData._id;\n        }\n      }\n      \n      // Ha nincs, próbáljuk a currentUser kulcsot\n      if (!newEvent.organizer) {\n        const currentUserStr = localStorage.getItem('currentUser');\n        if (currentUserStr) {\n          const currentUserData = JSON.parse(currentUserStr);\n          if (currentUserData && currentUserData._id) {\n            newEvent.organizer = currentUserData._id;\n          }\n        }\n      }\n    } catch (e) {\n      console.error('Hiba a felhasználó ID kiolvasása közben:', e);\n    }\n    \n    console.log('Küldés a szervernek:', newEvent);\n    return this.http.post<Event>(this.apiUrl, newEvent);\n  }\n\n  updateEvent(id: string, event: Event): Observable<Event> {\n    return this.http.put<Event>(`${this.apiUrl}/${id}`, event);\n  }\n\n  deleteEvent(id: string): Observable<void> {\n    return this.http.delete<void>(`${this.apiUrl}/${id}`);\n  }\n\n  getOrganizerEvents(): Observable<Event[]> {\n    return this.http.get<Event[]>(`${environment.apiUrl}/api/users/my-events`);\n  }\n\n  /**\n   * Jegyvásárlás metódus\n   * @param eventId Az esemény azonosítója\n   * @param categoryId A jegy kategória azonosítója\n   * @param quantity A megvásárolni kívánt jegyek száma\n   * @returns A vásárlást visszaigazoló adatok\n   */\n  purchaseTicket(eventId: string, categoryId: string, quantity: number): Observable<any> {\n    const purchaseData = {\n      eventId,\n      categoryId,\n      quantity\n    };\n    // Az apiUrl alapból már tartalmazza a /api előtagot\n    return this.http.post<any>(`${environment.apiUrl}/tickets`, purchaseData);\n  }\n} "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}